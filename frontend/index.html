<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Driver State Monitoring Dashboard</title>
    <link rel="stylesheet" href="/static/css/index.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js" type="text/javascript"></script>
</head>
<body id="general" onload="startup()">
    <nav class="nav">
        <a href="/" class="nav__link" data-link>Dashboard</a>
        <a href="/model" class="nav__link" data-link>Model</a>
        <a href="/else" class="nav__link" data-link>Something Else</a>
    </nav>
    <div id="app"></div>
    <div id="container1" class="mycontainer" style="display:flex; flex-direction: row; justify-content: left; align-items: center">
        <canvas id="bpm"></canvas>
        <canvas id="tmp"></canvas>
    </div>
    <div id="container2" class="mycontainer" style="display:flex; flex-direction: row; justify-content: left; align-items: center">
        <canvas id="rsp"></canvas>
        <canvas id="oxy"></canvas>
    </div>
    <script>
        // Function to manage updates for charts
        function addData(chart, label, data) {
            chart.data.labels.push(label);
            chart.data.datasets.forEach((dataset) => {
                dataset.data.push(data);
            });
            chart.update();
        }

        function removeData(chart) {
            chart.data.labels.shift()
            chart.data.datasets.forEach((dataset) => {
                dataset.data.shift()
            });
            chart.update();
        }

        // For updating all charts, only use the following function!

        function updateAllCharts(values) {
            // Chart 1
            addData(chart1,values[4].slice(10),values[1]);
            removeData(chart1);

            // Chart 2
            addData(chart2,values[4].slice(10),values[0]);
            removeData(chart2);

            // Chart 3
            addData(chart3,values[4].slice(10),values[2]);
            removeData(chart3);

            // Chart 4
            addData(chart4,values[4].slice(10),values[3]);
            removeData(chart4);
        }

        // Heart values
        var yValues = [120,70,80,85,110,135,167,120,90,95,85];

        // Temperature values
        var tValues = [35,36,36,37,35,30,29,32,33,35,33];

        // respiration values
        var rValues = [21,23,25,26,27,21,26,23,24,25,26];

        // oxygen values
        var oValues = [97,97,98,99,98,97,95,94,96,98,99];

        // Labels
        var xValues = [1,2,3,4,5,6,7,8,9,10,11];

        // Build the static datasets
        const data1 = {
            labels: xValues,
            datasets: [{
                label: 'First Record',
                data: yValues,
                borderColor: "rgba(255,0,0,1)"
            }]
        };

        const data2 = {
            labels: xValues,
            datasets: [{
                label: 'First Record',
                data: tValues,
                borderColor: "rgba(0,255,0,1)"
            }]
        };

        const data3 = {
            labels: xValues,
            datasets: [{
                label: 'First Record',
                data: rValues,
                borderColor: "rgba(0,0,255,1)"
            }]
        };

        const data4 = {
            labels: xValues,
            datasets: [{
                label: 'First Record',
                data: oValues,
                borderColor: "rgba(255,0,255,1)"
            }]
        };


        // Get the context of the canvas elements we want to select
        var ctx1 = document.getElementById("bpm").getContext("2d");
        var ctx2 = document.getElementById("tmp").getContext("2d");
        var ctx3 = document.getElementById("rsp").getContext("2d");
        var ctx4 = document.getElementById("oxy").getContext("2d");

        // Create the charts
        var chart1 = new Chart(ctx1, {
            type: 'line',
            data: data1,
            options: {
                plugins: {
                    title: {
                        text: "Heart Rate Evolution (bpm)",
                        display: true
                    }
                },
                responsive: true
            },
            maintainAspectRatio: false

        })

        var chart2 = new Chart(ctx2, {
            type: 'line',
            data: data2,
            options: {
                plugins: {
                    title: {
                        text: "Temperature Evolution (Â°C)",
                        display: true
                    }
                },
                responsive: true
            },
            maintainAspectRatio: false

        })

        var chart3 = new Chart(ctx3, {
            type: 'line',
            data: data3,
            options: {
                plugins: {
                    title: {
                        text: "Respiration Rate Evolution (bpm)",
                        display: true
                    }
                },
                responsive: true
            },
            maintainAspectRatio: false

        })

        var chart4 = new Chart(ctx4, {
            type: 'line',
            data: data4,
            options: {
                plugins: {
                    title: {
                        text: "Oxygen's Saturation Evolution (%)",
                        display: true
                    }
                },
                responsive: true
            },
            maintainAspectRatio: false

        })

    </script>
    <script>
        function startup() {
            var socketExample = new WebSocket("ws://localhost:3001");
            socketExample.onmessage = function (event) {
                var values = event.data.split(',')
                updateAllCharts(values)
            }
        }
    </script>
    <script type="module" src="/static/js/index.js"></script>
</body>
</html>